"use strict";
var fontdata = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,129,126,0,0,0,0,0,0,126,255,219,255,255,195,231,255,255,126,0,0,0,0,0,0,0,0,54,127,127,127,127,62,28,8,0,0,0,0,0,0,0,0,8,28,62,127,62,28,8,0,0,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,0,120,112,88,76,30,51,51,51,51,30,0,0,0,0,0,0,60,102,102,102,102,60,24,126,24,24,0,0,0,0,0,0,124,108,124,12,12,12,12,14,15,7,0,0,0,0,0,0,126,102,126,102,102,102,102,118,119,55,3,0,0,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,1,3,7,15,31,127,31,15,7,3,1,0,0,0,0,0,64,96,112,120,124,127,124,120,112,96,64,0,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,0,0,102,102,102,102,102,102,102,0,102,102,0,0,0,0,0,0,254,219,219,219,222,216,216,216,216,216,0,0,0,0,0,62,99,6,28,54,99,99,54,28,48,99,62,0,0,0,0,0,0,0,0,0,0,0,127,127,127,127,0,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,0,0,24,60,126,24,24,24,24,24,24,24,0,0,0,0,0,0,24,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,0,0,24,48,127,48,24,0,0,0,0,0,0,0,0,0,0,0,12,6,127,6,12,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,127,0,0,0,0,0,0,0,0,0,0,0,36,102,255,102,36,0,0,0,0,0,0,0,0,0,0,8,28,28,62,62,127,127,0,0,0,0,0,0,0,0,0,127,127,62,62,28,28,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,24,0,24,24,0,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,54,54,127,54,54,54,127,54,54,0,0,0,0,24,24,62,99,67,3,62,96,96,97,99,62,24,24,0,0,0,0,0,0,67,99,48,24,12,6,99,97,0,0,0,0,0,0,28,54,54,28,110,59,51,51,51,110,0,0,0,0,0,12,12,12,6,0,0,0,0,0,0,0,0,0,0,0,0,0,48,24,12,12,12,12,12,12,24,48,0,0,0,0,0,0,12,24,48,48,48,48,48,48,24,12,0,0,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,12,0,0,0,0,0,0,0,0,0,0,126,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,64,96,48,24,12,6,3,1,0,0,0,0,0,0,28,54,99,99,107,107,99,99,54,28,0,0,0,0,0,0,24,28,30,24,24,24,24,24,24,126,0,0,0,0,0,0,62,99,96,48,24,12,6,3,99,127,0,0,0,0,0,0,62,99,96,96,60,96,96,96,99,62,0,0,0,0,0,0,48,56,60,54,51,127,48,48,48,120,0,0,0,0,0,0,127,3,3,3,63,96,96,96,99,62,0,0,0,0,0,0,28,6,3,3,63,99,99,99,99,62,0,0,0,0,0,0,127,99,96,96,48,24,12,12,12,12,0,0,0,0,0,0,62,99,99,99,62,99,99,99,99,62,0,0,0,0,0,0,62,99,99,99,126,96,96,96,48,30,0,0,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,24,24,12,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,62,99,99,48,24,24,24,0,24,24,0,0,0,0,0,0,0,62,99,99,123,123,123,59,3,62,0,0,0,0,0,0,8,28,54,99,99,127,99,99,99,99,0,0,0,0,0,0,63,102,102,102,62,102,102,102,102,63,0,0,0,0,0,0,60,102,67,3,3,3,3,67,102,60,0,0,0,0,0,0,31,54,102,102,102,102,102,102,54,31,0,0,0,0,0,0,127,102,70,22,30,22,6,70,102,127,0,0,0,0,0,0,127,102,70,22,30,22,6,6,6,15,0,0,0,0,0,0,60,102,67,3,3,123,99,99,102,92,0,0,0,0,0,0,99,99,99,99,127,99,99,99,99,99,0,0,0,0,0,0,60,24,24,24,24,24,24,24,24,60,0,0,0,0,0,0,120,48,48,48,48,48,51,51,51,30,0,0,0,0,0,0,103,102,102,54,30,30,54,102,102,103,0,0,0,0,0,0,15,6,6,6,6,6,6,70,102,127,0,0,0,0,0,0,99,119,127,127,107,99,99,99,99,99,0,0,0,0,0,0,99,103,111,127,123,115,99,99,99,99,0,0,0,0,0,0,62,99,99,99,99,99,99,99,99,62,0,0,0,0,0,0,63,102,102,102,62,6,6,6,6,15,0,0,0,0,0,0,62,99,99,99,99,99,99,107,123,62,48,112,0,0,0,0,63,102,102,102,62,54,102,102,102,111,0,0,0,0,0,0,62,99,99,6,28,48,96,99,99,62,0,0,0,0,0,0,126,126,90,24,24,24,24,24,24,60,0,0,0,0,0,0,99,99,99,99,99,99,99,99,99,62,0,0,0,0,0,0,99,99,99,99,99,99,99,54,28,8,0,0,0,0,0,0,99,99,99,99,107,107,107,127,119,54,0,0,0,0,0,0,99,99,54,62,28,28,62,54,99,99,0,0,0,0,0,0,102,102,102,102,60,24,24,24,24,60,0,0,0,0,0,0,127,99,97,48,24,12,6,67,99,127,0,0,0,0,0,0,60,12,12,12,12,12,12,12,12,60,0,0,0,0,0,0,0,1,3,7,14,28,56,112,96,64,0,0,0,0,0,0,60,48,48,48,48,48,48,48,48,60,0,0,0,0,0,28,54,99,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,12,12,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,48,62,51,51,51,110,0,0,0,0,0,0,7,6,6,30,54,102,102,102,102,62,0,0,0,0,0,0,0,0,0,62,99,3,3,3,99,62,0,0,0,0,0,0,56,48,48,60,54,51,51,51,51,110,0,0,0,0,0,0,0,0,0,62,99,127,3,3,99,62,0,0,0,0,0,0,56,108,76,12,30,12,12,12,12,30,0,0,0,0,0,0,0,0,0,110,51,51,51,51,51,62,48,51,30,0,0,0,7,6,6,54,110,102,102,102,102,103,0,0,0,0,0,0,24,24,0,28,24,24,24,24,24,60,0,0,0,0,0,0,96,96,0,112,96,96,96,96,96,96,102,102,60,0,0,0,7,6,6,102,54,30,30,54,102,103,0,0,0,0,0,0,28,24,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,0,55,127,107,107,107,107,99,0,0,0,0,0,0,0,0,0,59,102,102,102,102,102,102,0,0,0,0,0,0,0,0,0,62,99,99,99,99,99,62,0,0,0,0,0,0,0,0,0,59,102,102,102,102,102,62,6,6,15,0,0,0,0,0,0,110,51,51,51,51,51,62,48,48,120,0,0,0,0,0,0,59,110,102,6,6,6,15,0,0,0,0,0,0,0,0,0,62,99,6,28,48,99,62,0,0,0,0,0,0,8,12,12,63,12,12,12,12,108,56,0,0,0,0,0,0,0,0,0,51,51,51,51,51,51,110,0,0,0,0,0,0,0,0,0,51,51,51,51,51,30,12,0,0,0,0,0,0,0,0,0,99,99,107,107,107,127,54,0,0,0,0,0,0,0,0,0,99,54,28,28,28,54,99,0,0,0,0,0,0,0,0,0,99,99,99,99,99,99,126,96,48,31,0,0,0,0,0,0,127,51,24,12,6,99,127,0,0,0,0,0,0,112,24,24,24,14,24,24,24,24,112,0,0,0,0,0,0,24,24,24,24,24,24,24,24,24,24,0,0,0,0,0,0,14,24,24,24,112,24,24,24,24,14,0,0,0,0,0,0,0,0,0,0,110,59,0,0,0,0,0,0,0,0,0,0,0,0,8,28,54,99,99,99,127,0,0,0,0];

var colordata = [
    [0, 0, 0],
    [0, 0, 0xaa],
    [0, 0xaa, 0],
    [0, 0xaa, 0xaa],
    [0xaa, 0, 0],
    [0xaa, 0, 0xaa],
    [0xaa, 0x55, 0],
    [0xaa, 0xaa, 0xaa],
    [0x55, 0x55, 0x55],
    [0x55, 0x55, 0xff],
    [0x55, 0xff, 0x55],
    [0x55, 0xff, 0xff],
    [0xff, 0x55, 0x55],
    [0xff, 0x55, 0xff],
    [0xff, 0xff, 0x55],
    [0xff, 0xff, 0xff],
];

(() => {
    var term = new Array(80 * 25).fill(0);
    var color = new Array(80 * 25).fill(7);
    window.term = term;
    window.color = color;
    window.colordata = colordata;
    var currentColor = 7;

    var c = document.getElementById("hehehehehenicz");
    var ctx = c.getContext("2d");

    var width = c.width = 720;
    var height = c.height = 400;

    var px = ctx.createImageData(1,1);
    var d = px.data;

    var cursorX = 0;
    var cursorY = 0;

    var blink = true;
    var drawHook = null;
    var keyHook = null;
    var enterHook = null;

    var buf = "";

    document.addEventListener('keydown', (event) => {        
        if (keyHook)
            keyHook(event);
    });

    setInterval(() => blink = !blink, 250);

    var put = (x, y, col) => {
        d[0] = col[0];
        d[1] = col[1];
        d[2] = col[2];
        d[3] = 255;
        ctx.putImageData(px, x, y);
    }

    var draw = () => {
        if (drawHook)
            drawHook();

        requestAnimationFrame(draw);
    }

    var drawTTY = () => {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, width, height);
        
        let c, dat, col, pos = 0;

        for (let x = 0; x < 80; x++) {
            for (let y = 0; y < 25; y++) {
                pos = y * 80 + x;
                c = term[pos];
                col = color[pos];

                if (c !== 0) {
                    for (let i = 0; i < 16; i++) {
                        dat = fontdata[c * 16 + i];

                        if (dat !== 0) {
                            for (let j = 0; j < 8; j++) {
                                if (dat & (1 << j))
                                    put(x * 9 + j, y * 16 + i, colordata[col]);
                            }
                        }
                    }
                }
            }
        }

        if (blink) {
            ctx.fillStyle = "#aaaaaa";
            ctx.fillRect(cursorX * 9, (cursorY + 1) * 16 - 2, 9, 2);
        }
    }

    var moveUp = () => {
        for (let i = 0; i < (80*24); i++) {
            term[i] = term[i + 80];
            color[i] = color[i + 80];
        }

        for (let i = 0; i < 80; i++)
            term[80*24+i] = color[80*24+i] = 0;
    };

    var putString = str => {
        let pos, c = 0;

        for (let i = 0; i < str.length; i++) {
            c = str.charCodeAt(i);

            if (c == 0x0a) {
                cursorX = 0;
                cursorY++;
            } else {
                pos = cursorY * 80 + cursorX;
                term[pos] = c;
                color[pos] = currentColor;
                cursorX++;
            }

            if (cursorX == 80) {
                cursorX = 0;
                cursorY++;
            }

            if (cursorY == 25) {
                moveUp();
                cursorY = 24;
            }
        }
    };

    var keyTyper = e => {
        if ((e.keyCode >= 32 && e.keyCode <= 90)) {
            buf += e.key;
            putString(e.key);
        } else if (e.keyCode == 27) {
            buf += "\e";
            putString("^[");
        } else if (e.keyCode == 8) {
            if (buf.length != 0) {
                if (buf.charCodeAt(buf.length - 1) == 101) {
                    term[cursorY * 80 + cursorX - 1] = 0;
                    term[cursorY * 80 + cursorX - 2] = 0;

                    if (cursorX == 0) {
                        cursorX = 79;
                        cursorY--;
                    } else {
                        cursorX--;
                        if (cursorX == 0) {
                            cursorX = 79;
                            cursorY--;
                        } else cursorX--;
                    }
                } else {
                    term[cursorY * 80 + cursorX - 1] = 0;

                    if (cursorX == 0) {
                        cursorX = 79;
                        cursorY--;
                    } else {
                        cursorX--;
                    }
                }

                buf = buf.substring(0, buf.length - 1);
            }
        } else if (e.keyCode == 13) {
            putString("\n");
            if (enterHook)
                enterHook();
        }
    };

    var initOS = () => {
        setTimeout(() => {
            drawHook = drawTTY;
            
            width = c.width = 720;
            height = c.height = 400;
            
            currentColor = 12;

            putString("                      :::!~!!!!!:.\n");
            putString("                  .xUHWH!! !!?M88WHX:.\n");
            putString("                .X*#M@$!!  !X!M$$$$$$WWx:.\n");
            putString("               :!!!!!!?H! :!$!$$$$$$$$$$8X:\n");
            putString("              !!~  ~:~!! :~!$!#$$$$$$$$$$8X:\n");
            putString("             :!~::!H!<   ~.U$X!?R$$$$$$$$MM!\n");
            putString("             ~!~!!!!~~ .:XW$$$U!!?$$$$$$RMM!\n");
            putString("               !:~~~ .:!M\"T#$$$$WX??#MRRMMM!\n");
            putString("               ~?WuxiW*`   `\"#$$$$8!!!!??!!!\n");
            putString("             :X- M$$$$       `\"T#$T~!8$WUXU~\n");
            putString("            :%`  ~#$$$m:        ~!~ ?$$$$$$\n");
            putString("          :!`.-   ~T$$$$8xx.  .xWW- ~\"\"##*\"\n");
            putString(".....   -~~:<` !    ~?T#$$@@W@*?$$      /`\n");
            putString("W$@@M!!! .!~~ !!     .:XUW$W!~ `\"~:    :\n");
            putString("#\"~~`.:x%`!!  !H:   !WM$$$$Ti.: .!WUn+!`\n");
            putString(":::~:!!`:X~ .: ?H.!u \"$$$B$$$!W:U!T$$M~\n");
            putString(".~~   :X@!.-~   ?@WTWo(\"*$$$W$TH$! `\n");
            putString("Wi.~!X$?!-~    : ?$$$B$Wu(\"**$RM!\n");
            putString("$R@i.~~ !     :   ~$$$$$B$$en:``\n");
            putString("?MXT@Wx.~    :     ~\"##*$$$$M~\n\nHACKING IN PROGRESS BLACK AND WHITE HAT!!\n\n");
        }, 3000);
        
        const done = () => {
            currentColor = 2;
            putString(" done\n");
            currentColor = 7;
        }
        done.bind(this);

        setTimeout(() => {
            currentColor = 15;
            putString("System operation HenioooOS 2.0 is loading!\n\n");
            currentColor = 7;
        }, 8000);

        setTimeout(() => {
            putString("INITIALIZATION RAM...");
        }, 11000);
        
        setTimeout(() => {
            done();
            putString("INITIALIZATION CPU...");
        }, 12000);

        setTimeout(() => {
            done();
            putString("INITIALIZATION HACKING...");
        }, 13000);

        setTimeout(() => {
            done();
            putString("INITIALIZATION BOOT...");
        }, 14000);

        setTimeout(() => {
            done();
            putString("INITIALIZATION PROCESS...");
        }, 15000);

        setTimeout(() => {
            done();
            putString("INITIALIZATION INTERNET...");
        }, 16000);

        setTimeout(done, 17000);

        setTimeout(() => {
            term.fill(0);
            cursorX = cursorY = 0;
        }, 20000);

        setTimeout(() => {
            putString("HenioooOS 2.0 henicz tty1\n\nhenicz login: ");

            enterHook = () => {
                buf = "";
                putString("Password: ");
                keyHook = () => {
                    if (e.keyCode == 13) {
                        putString("\n");
                        if (enterHook)
                            enterHook();
                    }
                };
                keyHook.bind(this);

                enterHook = () => {
                    buf = "";
                    enterHook = null;
                    currentColor = 12;
                    setTimeout(() => {
                        putString("\n\n>> ACCESS DENIED PLEASE WAIT HACKING IN PROGRESS!!!!!!!!! <<\n\n");
                    }, 2000);

                    setTimeout(() => {
                        putString("HACKING SUCCESS ACCESS GRANTED WAIT WHILE LOADING SYSTEM OPERATION HENIOOOOS 2.0 GUI EDITION!\n\n");
                    }, 5000);

                    setTimeout(() => window.location.href = "login.html", 10000);
                };
            };

            keyHook = keyTyper;
            keyHook.bind(this);
        }, 24000);
    };

    var image = new Image();
    image.onload = () => {
        width = c.width = 800;
        height = c.height = 600;
        setTimeout(() => drawHook = () => ctx.drawImage(image, 0, 0), 2000);
        
        color.fill(15);

        requestAnimationFrame(draw);
        setTimeout(() => initOS(), 4000);
    };
    image.src = 'splash.png';

})();